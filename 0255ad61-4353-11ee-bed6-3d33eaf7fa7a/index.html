<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/avatar.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/avatar.png" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.dcheng.site","root":"/","images":"/images","scheme":"Pisces","darkmode":true,"version":"8.13.2","exturl":false,"sidebar":{"position":"left","display":"hide","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"utterances","storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="article">
<meta property="og:title" content="win、ubuntu 环境安装 postgresql 15">
<meta property="og:url" content="http://www.dcheng.site/0255ad61-4353-11ee-bed6-3d33eaf7fa7a/index.html">
<meta property="og:site_name" content="Notebook">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2023-07-30T12:33:35.000Z">
<meta property="article:modified_time" content="2024-03-31T12:23:44.465Z">
<meta property="article:author" content="Mr.Dcheng">
<meta property="article:tag" content="postgresql">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://www.dcheng.site/0255ad61-4353-11ee-bed6-3d33eaf7fa7a/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://www.dcheng.site/0255ad61-4353-11ee-bed6-3d33eaf7fa7a/","path":"0255ad61-4353-11ee-bed6-3d33eaf7fa7a/","title":"win、ubuntu 环境安装 postgresql 15"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>win、ubuntu 环境安装 postgresql 15 | Notebook</title>
  






  <script async defer data-website-id="" src=""></script>

  <script defer data-domain="" src=""></script>

  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/rss2.xml" title="Notebook" type="application/rss+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container" style="background-image: linear-gradient(45deg, rgb(2, 0, 49) 0px, rgb(109, 51, 83) 70%);background-size: initial;background-position-x: initial;">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Notebook</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">温故而知新</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-rss"><a href="/rss2.xml" rel="section"><i class="fa fa-rss fa-fw"></i>RSS</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1%E3%80%81win10-%E6%88%96-Windows-Server-2022-Datacenter"><span class="nav-text">1、win10 或 Windows Server 2022 Datacenter</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1%E3%80%81%E6%89%A7%E8%A1%8C%E5%AE%89%E8%A3%85"><span class="nav-text">1.1、执行安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2%E3%80%81ubuntu-22-04"><span class="nav-text">2、ubuntu 22.04</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1%E3%80%81%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3"><span class="nav-text">2.1、官方文档</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2%E3%80%81%E6%89%A7%E8%A1%8C-pg-15-3-%E5%AE%89%E8%A3%85"><span class="nav-text">2.2、执行 pg-15.3 安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3%E3%80%81%E6%9F%A5%E7%9C%8B%E6%9C%8D%E5%8A%A1"><span class="nav-text">2.3、查看服务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3%E3%80%81%E6%9F%A5%E7%9C%8B%E8%B7%AF%E5%BE%84"><span class="nav-text">2.3、查看路径</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-4%E3%80%81%E7%99%BB%E5%BD%95"><span class="nav-text">2.4、登录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3%E3%80%81%E9%80%9A%E7%94%A8%E9%83%A8%E5%88%86"><span class="nav-text">3、通用部分</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1%E3%80%81%E5%88%9B%E5%BB%BA%E8%A7%92%E8%89%B2"><span class="nav-text">3.1、创建角色</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2%E3%80%81%E6%9F%A5%E7%9C%8B%E7%89%88%E6%9C%AC"><span class="nav-text">3.2、查看版本</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3%E3%80%81%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95"><span class="nav-text">3.3、远程登录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3-1%E3%80%81pg-hba-conf-%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0"><span class="nav-text">3.3.1、pg_hba.conf 配置参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4%E3%80%81%E9%97%AE%E9%A2%98%E9%9B%86%E9%94%A6"><span class="nav-text">4、问题集锦</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1%E3%80%81UTC-%E6%97%B6%E9%97%B4%E4%B8%8E%E7%B3%BB%E7%BB%9F%E6%97%B6%E9%97%B4%E5%81%8F%E5%B7%AE-8-%E5%B0%8F%E6%97%B6"><span class="nav-text">4.1、UTC 时间与系统时间偏差 8 小时</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Mr.Dcheng"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Mr.Dcheng</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">89</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">47</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>





  <div class="links-of-author animated" style="display:none">
      <span class="links-of-author-item">
        <a href="https://github.com/clxering" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;clxering" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://mp.weixin.qq.com/mp/profile_ext?action=home&__biz=Mzg3OTczMDI3Mw==&scene=124#wechat_redirect" title="Weixin → https:&#x2F;&#x2F;mp.weixin.qq.com&#x2F;mp&#x2F;profile_ext?action&#x3D;home&amp;__biz&#x3D;Mzg3OTczMDI3Mw&#x3D;&#x3D;&amp;scene&#x3D;124#wechat_redirect" rel="noopener" target="_blank"><i class="fab fa-weixin fa-fw"></i>Weixin</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://www.dcheng.site/0255ad61-4353-11ee-bed6-3d33eaf7fa7a/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Mr.Dcheng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Notebook">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="win、ubuntu 环境安装 postgresql 15 | Notebook">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header" style="margin-bottom:0">
        <h1 class="post-title" itemprop="name headline" style="text-align:left">
          win、ubuntu 环境安装 postgresql 15
        </h1>

        <div class="post-meta-container">
          <div class="post-meta" style="display:block;margin:0px;text-align:left">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-07-30 20:33:35" itemprop="dateCreated datePublished" datetime="2023-07-30T20:33:35+08:00">2023-07-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-03-31 20:23:44" itemprop="dateModified" datetime="2024-03-31T20:23:44+08:00">2024-03-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E9%83%A8%E7%BD%B2%E5%92%8C%E5%AE%89%E8%A3%85/" itemprop="url" rel="index"><span itemprop="name">部署和安装</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <blockquote>
</blockquote>
<span id="more"></span>

<h2 id="1、win10-或-Windows-Server-2022-Datacenter"><a href="#1、win10-或-Windows-Server-2022-Datacenter" class="headerlink" title="1、win10 或 Windows Server 2022 Datacenter"></a>1、win10 或 Windows Server 2022 Datacenter</h2><p>下载地址：<a target="_blank" rel="noopener" href="https://www.enterprisedb.com/download-postgresql-binaries">https://www.enterprisedb.com/download-postgresql-binaries</a></p>
<h2 id="1-1、执行安装"><a href="#1-1、执行安装" class="headerlink" title="1.1、执行安装"></a>1.1、执行安装</h2><p>1）解压，并添加 <code>pgsql\bin</code> 到环境变量。</p>
<p>2）新建目录 <code>C:\pgsql\data</code>，执行 <code>initdb -U postgres -A password -E UTF-8 -W -D C:\pgsql\data</code>，该步骤将提示输入密码。</p>
<p>3）执行 <code>pg_ctl -D &quot;C:/pgsql/data&quot; start</code> 启动服务。</p>
<p>4）执行 <code>psql -U postgres</code> 登录，输入之前步骤的密码。</p>
<blockquote>
<p>注意：控制台方式启动服务，当关闭控制台时，服务随即终止。若要保持后台启动，需要注册服务。</p>
</blockquote>
<p>5）注册服务：以管理员身份执行 <code>pg_ctl register -N PostgreSQL -D &quot;C:/pgsql/data&quot;</code>，再执行 <code>net start PostgreSQL</code></p>
<h2 id="2、ubuntu-22-04"><a href="#2、ubuntu-22-04" class="headerlink" title="2、ubuntu 22.04"></a>2、ubuntu 22.04</h2><h2 id="2-1、官方文档"><a href="#2-1、官方文档" class="headerlink" title="2.1、官方文档"></a>2.1、官方文档</h2><p>文档地址：<a target="_blank" rel="noopener" href="https://www.postgresql.org/download/linux/ubuntu/">https://www.postgresql.org/download/linux/ubuntu/</a> （version：20230726）</p>
<p><strong>Linux downloads (Ubuntu) Ubuntu</strong></p>
<p>PostgreSQL is available in all Ubuntu versions by default. However, Ubuntu “snapshots” a specific version of PostgreSQL that is then supported throughout the lifetime of that Ubuntu version. Other versions of PostgreSQL are available through the PostgreSQL apt repository.</p>
<p><strong>PostgreSQL Apt Repository</strong></p>
<p>If the version included in your version of Ubuntu is not the one you want, you can use the PostgreSQL Apt Repository. This repository will integrate with your normal systems and patch management, and provide automatic updates for all supported versions of PostgreSQL throughout the support lifetime of PostgreSQL.</p>
<p>The PostgreSQL Apt Repository supports the current versions of Ubuntu:</p>
<ul>
<li>kinetic (22.10, non-LTS)</li>
<li>jammy (22.04, LTS)</li>
<li>focal (20.04, LTS)</li>
<li>bionic (18.04, LTS)</li>
</ul>
<p>on the following architectures:</p>
<ul>
<li>amd64</li>
<li>arm64 (18.04 and newer; LTS releases only)</li>
<li>i386 (18.04 and older)</li>
<li>ppc64el (LTS releases only)</li>
</ul>
<p>To use the apt repository, follow these steps:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Create the file repository configuration:</span></span><br><span class="line">sudo sh -c <span class="string">&#x27;echo &quot;deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main&quot; &gt; /etc/apt/sources.list.d/pgdg.list&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Import the repository signing key:</span></span><br><span class="line">wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -</span><br><span class="line"></span><br><span class="line"><span class="comment"># Update the package lists:</span></span><br><span class="line">sudo apt-get update</span><br><span class="line"></span><br><span class="line"><span class="comment"># Install the latest version of PostgreSQL.</span></span><br><span class="line"><span class="comment"># If you want a specific version, use &#x27;postgresql-12&#x27; or similar instead of &#x27;postgresql&#x27;:</span></span><br><span class="line">sudo apt-get -y install postgresql-15</span><br></pre></td></tr></table></figure>

<p>For more information about the apt repository, including answers to frequent questions, please see the PostgreSQL Apt Repository page on the wiki.</p>
<p><strong>Included in distribution</strong></p>
<p>Ubuntu includes PostgreSQL by default. To install PostgreSQL on Ubuntu, use the apt-get (or other apt-driving) command:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install postgresql-12</span><br></pre></td></tr></table></figure>

<p>The repository contains many different packages including third party addons. The most common and important packages are (substitute the version number as required):</p>
<h2 id="2-2、执行-pg-15-3-安装"><a href="#2-2、执行-pg-15-3-安装" class="headerlink" title="2.2、执行 pg-15.3 安装"></a>2.2、执行 pg-15.3 安装</h2><p>执行 <code>sudo apt-get -y install postgresql-15</code> 将安装 15.3</p>
<h2 id="2-3、查看服务"><a href="#2-3、查看服务" class="headerlink" title="2.3、查看服务"></a>2.3、查看服务</h2><p>执行 <code>sudo systemctl status postgresql</code> 查看服务运行情况：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">postgresql.service - PostgreSQL RDBMS</span><br><span class="line">     Loaded: loaded (/lib/systemd/system/postgresql.service; enabled; vendor preset:&gt;</span><br><span class="line">     Active: active (exited) since Tue 2023-07-25 09:55:14 CST; 12min ago</span><br><span class="line">   Main PID: 4625 (code=exited, status=0/SUCCESS)</span><br><span class="line">        CPU: 2ms</span><br></pre></td></tr></table></figure>

<h2 id="2-3、查看路径"><a href="#2-3、查看路径" class="headerlink" title="2.3、查看路径"></a>2.3、查看路径</h2><p>执行 <code>ps -ef | grep postgres | grep -v &#39;grep&#39;</code> 显示如下内容：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">postgres    5671       1  0 09:55 ?        00:00:00 /usr/lib/postgresql/15/bin/postgres -D /var/lib/postgresql/15/main -c config_file=/etc/postgresql/15/main/postgresql.conf</span><br><span class="line">postgres    5672    5671  0 09:55 ?        00:00:00 postgres: 15/main: checkpointer</span><br><span class="line">postgres    5673    5671  0 09:55 ?        00:00:00 postgres: 15/main: background writer</span><br><span class="line">postgres    5675    5671  0 09:55 ?        00:00:00 postgres: 15/main: walwriter</span><br><span class="line">postgres    5676    5671  0 09:55 ?        00:00:00 postgres: 15/main: autovacuum launcher</span><br><span class="line">postgres    5677    5671  0 09:55 ?        00:00:00 postgres: 15/main: logical replication launcher</span><br></pre></td></tr></table></figure>

<p>可获知以下信息：</p>
<ul>
<li>安装目录：<code>/usr/lib/postgresql/15/bin/postgres</code></li>
<li>初始化数据库的数据目录：<code>/var/lib/postgresql/15/main</code></li>
<li>配置文件路径：<code>/etc/postgresql/15/main/postgresql.conf</code></li>
</ul>
<h2 id="2-4、登录"><a href="#2-4、登录" class="headerlink" title="2.4、登录"></a>2.4、登录</h2><p>1）切换用户：执行 <code>su - postgres</code></p>
<blockquote>
<p>注意：如果提示 <code>su：认证失败</code>，需要执行 <code>sudo passwd postgres</code> 设置密码再切换，输入设置的密码即可。</p>
</blockquote>
<p>2）输入 <code>psql</code> 登录</p>
<blockquote>
<p>如果本地登录需要切换新增的角色，要在 <code>pg_hba.conf</code> 配置认证方式。例如：<code>local  all  all  md5</code></p>
</blockquote>
<h2 id="3、通用部分"><a href="#3、通用部分" class="headerlink" title="3、通用部分"></a>3、通用部分</h2><h2 id="3-1、创建角色"><a href="#3-1、创建角色" class="headerlink" title="3.1、创建角色"></a>3.1、创建角色</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE ROLE name [ [ WITH ] option [ ... ] ]</span><br></pre></td></tr></table></figure>

<p>option 属性</p>
<ul>
<li>登录权限（LOGIN ），具有该属性的角色才能连接数据库。</li>
<li>创建数据库（CREATEDB），具有该属性的角色才能够创建数据库（超级用户除外）。</li>
<li>创建角色（CREATEROLE），具有该属性的角色才能够创建其他角色（超级用户除外）。</li>
<li>启动复制（REPLICATION），具有该属性的角色才能够启动流复制（超级用户除外）。</li>
<li>密码（PASSWORD），只有当用户连接数据库使用的客户端认证方法要求提供密码时，密码属性才有意义。password 和 md5 认证方法需要使用密码。</li>
<li>超级用户（SUPERUSER），数据的超级用户可以避开所有的权限检查，只验证登录权限。</li>
</ul>
<p>例 1，创建角色并赋予【登录、创建数据库、密码】属性：<code>create role abc123 login createdb password &#39;abc123&#39;;</code></p>
<p>例 2，修改角色属性：<code>alter role &lt;role_name&gt; login createdb;</code></p>
<blockquote>
<p>注：可执行 <code>\du</code> 查看当前全部角色</p>
</blockquote>
<h2 id="3-2、查看版本"><a href="#3-2、查看版本" class="headerlink" title="3.2、查看版本"></a>3.2、查看版本</h2><p>执行 <code>psql --version</code> 查看当前版本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psql (PostgreSQL) 15.3 (Ubuntu 15.3-1.pgdg22.04+1)</span><br></pre></td></tr></table></figure>

<h2 id="3-3、远程登录"><a href="#3-3、远程登录" class="headerlink" title="3.3、远程登录"></a>3.3、远程登录</h2><ul>
<li>修改 <code>/etc/postgresql/15/main/pg_hba.conf</code>，按需增加配置，如：<code>host  all  all  0.0.0.0/0  md5</code></li>
<li>修改配置文件 <code>postgresql.conf</code>，将 <code>listen_addresses = &#39;localhost&#39;</code> 修改为 <code>listen_addresses = &#39;*&#39;</code></li>
<li>执行 <code>sudo systemctl restart postgresql</code> 重启服务</li>
</ul>
<blockquote>
<p>注意：即使修改配置文件，还应保证防火墙放行。尤其是 win 环境，需要在防火墙入站规则添加 5432 端口的放行规则。</p>
</blockquote>
<h2 id="3-3-1、pg-hba-conf-配置参数"><a href="#3-3-1、pg-hba-conf-配置参数" class="headerlink" title="3.3.1、pg_hba.conf 配置参数"></a>3.3.1、<code>pg_hba.conf</code> 配置参数</h2><p>1）TYPE（主机类型）</p>
<ul>
<li><code>local</code>，unix-domain 的 socket 连接</li>
<li><code>host</code>，TCP&#x2F;IP socket</li>
<li><code>hostssl</code>，SSL 加密的 TCP&#x2F;IP socket</li>
</ul>
<p>2）DATABASE（数据库名称）</p>
<p><code>all</code>、<code>sameuser</code>、<code>samerole</code>、<code>replication</code>、<code>数据库名称</code>，或者多个数据库名称用 <code>逗号</code></p>
<blockquote>
<p>注意：all 不匹配 <code>replication</code></p>
</blockquote>
<p>3）USER（用户名称）</p>
<p><code>all</code>、<code>一个用户名</code>、<code>一组用户名</code>，多个用户时，可以用逗号隔开，或者在用户名称前缀 <code>+</code>，在 USER 和 DATABASE 字段，也可以写一个单独的文件名称用 <code>@</code> 前缀，该文件包含数据库名称或用户名称。</p>
<p>4）ADDRESS（地址范围）</p>
<p>该参数可以为 <code>主机名称</code> 或者 <code>IP/32(IPV4)</code> 或 <code>IP/128(IPV6)</code>，主机名称以 <code>.</code> 开头，<code>samehost</code> 或 <code>samenet</code> 匹配任意 ip 地址</p>
<p>5）METHOD（验证方式）</p>
<ul>
<li><code>trust</code>，无需密码验证可直接连接访问</li>
<li><code>reject</code>，拒绝访问</li>
<li><code>md5</code>，以 md5 加密</li>
<li><code>password</code>，明文传输密码</li>
<li><code>scram-sha-256</code></li>
<li><code>gss</code></li>
<li><code>sspi</code></li>
<li><code>ident</code></li>
<li><code>peer</code></li>
<li><code>pam</code></li>
<li><code>ldap</code></li>
<li><code>radius</code></li>
<li><code>cert</code></li>
</ul>
<blockquote>
<p>注意：若为 <code>password</code> 则发送的为明文密码</p>
</blockquote>
<h2 id="4、问题集锦"><a href="#4、问题集锦" class="headerlink" title="4、问题集锦"></a>4、问题集锦</h2><h3 id="4-1、UTC-时间与系统时间偏差-8-小时"><a href="#4-1、UTC-时间与系统时间偏差-8-小时" class="headerlink" title="4.1、UTC 时间与系统时间偏差 8 小时"></a>4.1、UTC 时间与系统时间偏差 8 小时</h3><p><strong>解决方案：</strong></p>
<p>1）显式指定 PRC</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> now() <span class="keyword">at</span> <span class="type">time</span> zone <span class="string">&#x27;PRC&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>结果：<code>2023-07-30 16:01:17.285747</code></p>
<p>2）进一步指定格式</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> to_char(now() <span class="keyword">at</span> <span class="type">time</span> zone <span class="string">&#x27;PRC&#x27;</span>,<span class="string">&#x27;YYYY-MM-DD hh24:mi:ss&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>结果：<code>2023-07-30 16:03:34</code></p>

    </div>

    
    
    

    <footer class="post-footer">

        
        
        

        <script src="https://giscus.app/client.js"
          data-repo="clxering/clxering.github.io"
          data-repo-id="MDEwOlJlcG9zaXRvcnkxNDgzMDExMDk="
          data-category="Announcements"
          data-category-id="DIC_kwDOCNblNc4CT1Cc"
          data-mapping="pathname"
          data-strict="1"
          data-reactions-enabled="1"
          data-emit-metadata="0"
          data-input-position="bottom"
          data-theme="light"
          data-lang="zh-CN"
          crossorigin="anonymous"
          async>
        </script>
          <div class="post-tags">
              <a href="/tags/postgresql/" rel="tag"># postgresql</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/468704c0-2bb6-11ee-879b-0b2c36f14b2e/" rel="prev" title="volatile-变量使用指南">
                  <i class="fa fa-chevron-left"></i> volatile-变量使用指南
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/0255ad60-4353-11ee-bed6-3d33eaf7fa7a/" rel="next" title="ubuntu-配置共享文件夹">
                  ubuntu-配置共享文件夹 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mr.Dcheng</span>

  
  
  
    <div class="copyright">
        <span class="author">
          <a href="https://github.com/clxering" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;clxering" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
        </span>
        <span class="author">
          <a href="https://mp.weixin.qq.com/mp/profile_ext?action=home&__biz=Mzg3OTczMDI3Mw==&scene=124#wechat_redirect" title="Weixin → https:&#x2F;&#x2F;mp.weixin.qq.com&#x2F;mp&#x2F;profile_ext?action&#x3D;home&amp;__biz&#x3D;Mzg3OTczMDI3Mw&#x3D;&#x3D;&amp;scene&#x3D;124#wechat_redirect" rel="noopener" target="_blank"><i class="fab fa-weixin fa-fw"></i>Weixin</a>
        </span>
    </div>

</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/pace.js"></script>

  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
